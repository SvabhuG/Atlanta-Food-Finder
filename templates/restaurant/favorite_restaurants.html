<div class="container">
    <h2>My Favorite Restaurants</h2>

    <!-- Button to go back to the main search page -->
    <div class="mb-4">
        <a href="{% url 'search_restaurants' %}" class="btn btn-secondary">Back to Search</a>
    </div>

    <div class="row mt-4">
        <!-- Left column: favorite restaurants -->
        <div class="col-md-8">
            <div class="row">
                {% for favorite in favorite_restaurants %}
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <img src="{{ favorite.restaurant_photo_reference }}" class="card-img-top" alt="{{ favorite.restaurant_name }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ favorite.restaurant_name }}</h5>
                            <p class="card-text">{{ favorite.restaurant_address }}</p>
                            <p class="card-text">Rating: {{ favorite.restaurant_rating }}</p>

                            <!-- Unlike button -->
                            <form method="post" action="{% url 'unlike_restaurant' favorite.restaurant.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">Unlike</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p>You haven't liked any restaurants yet.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Right column: Map -->
        <div class="col-md-4">
            <div id="map" style="height: 500px; width: 100%;"></div>
        </div>
    </div>
</div>

<script>
    let map;
    let markers = []; // Array to hold markers

    function initMap() {
        // Create a map centered on a default location (Atlanta)
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: {lat: 33.7490, lng: -84.3880} // Default center on Atlanta
        });

        // Clear existing markers
        markers.forEach(marker => marker.setMap(null));
        markers = [];

        // Loop through the favorite restaurants and add markers to the map
        {% for favorite in favorite_restaurants %}
        addMarker({
            lat: {{ favorite.latitude }},
            lng: {{ favorite.longitude }},
            name: "{{ favorite.restaurant_name }}",
            address: "{{ favorite.restaurant_address }}"
        });
        {% endfor %}
    }

    function addMarker(place) {
        const marker = new google.maps.Marker({
            position: {lat: place.lat, lng: place.lng},
            map: map,
            title: place.name
        });

        const infowindow = new google.maps.InfoWindow({
            content: `<h5>${place.name}</h5><p>${place.address}</p>`
        });

        marker.addListener('click', function() {
            infowindow.open(map, marker);
        });

        markers.push(marker);
    }

    // Initialize the map when the page loads
    window.onload = initMap;
</script>

<!-- Include the Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async defer></script>
